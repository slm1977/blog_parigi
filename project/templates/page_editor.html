<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script type="text/javascript">

        // Shorthand for $( document ).ready()
        $(function() {
            console.log( "ready!" );

            var frm = $('#editing_form');
            //var ser = frm.serialize();
            console.log("Form serializzato");
            console.log($('#editing_form').html());
            frm.submit(function (e) {

                e.preventDefault();

                $.ajax({
                    type: frm.attr('method'),
                    url: frm.attr('action'),
                    data: { 'content': CKEDITOR.instances.editor.getData(),
                    menu_index : $('#menu_index').val(),
                    menu_title : $('#menu_title').val()
                    },
                    success: function (data) {
                        console.log('Submission was successful.');
                        console.log(data);
                        $('#formResponse').html("Modifiche salvate");
                    },
                    error: function (data) {
                        console.log('An error occurred.');
                        console.log(data);
                    },
                });
            });


        });



</script>
</head>
<body>
<form id="editing_form" method="POST", action="{{url_for("main.save_page")}}">
<p>

    <div class="field">
        <div class="control">
            <label for="menu_title">Voce sul menu della pagina: </label>
            <input name="menu_title" id="menu_title"  type="text" value="" required/><br>
        </div>
    </div>

<div class="field">
        <div class="control">
        <label for="menu_index">Posizione sul menu della pagina: </label>
        <input name="menu_index" id="menu_index" type="number" value="" required/><br>
    </div>
</div>

    <input type="submit" value="Salva"/> <p id="formResponse"></p>
</p>



    <div id="editor" name="editor_div">
        <p id="page_content">{{content|safe}}</p>
    </div>

</form>




<script src="{{url_for('static', filename='ckeditor/ckeditor.js')}}"></script>
<script>
 document.getElementById("editor").value = "<p>Some other editor data.</p>";
    //CKFinder.setupCKEditor();
    var ed = CKEDITOR.replace( 'editor' ,{
                                            toolbar: 'Basic',
                                            uiColor: '#9AB8F3'
                                            }
                                       );


    // The "change" event is fired whenever a change is made in the editor.
    CKEDITOR.instances.editor.on( 'change', function( evt ) {
        // getData() returns CKEditor's HTML content.
     //console.log( 'Total bytes: ' + evt.editor.getData().length );
     $('#formResponse').html('<span style="color:red;">Da salvare</span>');
    });

    CKEDITOR.instances.editor.on( 'uploadingImage', function( evt ) {
        // getData() returns CKEditor's HTML content.
     console.log( 'Upload della immagine!');
        });

        ed.on( 'imageUploaded', function( evt ) {
        // getData() returns CKEditor's HTML content.
        console.log( 'Immagine uploadata!');
        });

     CKEDITOR.instances.editor.on( 'save', function( evt ) {
     console.log("Saving...");
     });


</script>
</body>
</html>